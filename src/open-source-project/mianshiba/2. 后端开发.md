---
order: 2
category: 
- 项目
tag: 
- 面试吧
---

# 第二期 - 后端开发

面试吧笔记第二期 - 后端开发

<!-- more -->

## 1. 需求分析

目标：明确要做的需求，并且给需求设置优先级，从而明确开发计划。

根据核心业务业务流程，明确需求开发的优先级：
- $P0$ 为核心，非做不可
- $P1$ 为重点功能，最好做
- $P2$ 为实用功能，有空就做
- $P3$ 可做可不做，时间充裕再做

确定优先级的需求列表如下。

### 1.1 基础功能（均为$P0$）

- 用户模块
  - 用户注册
  - 用户登录（账号密码）
  - 【管理员】管理用户-增删改查

- 题库模块
  - 查看题库列表
  - 查看题库详情（展示题库下的题目）
  - 【管理员】管理题库-增删改查

- 题目模块
  - 题目搜索
  - 查看题目详情（进入刷题页面）
  - 【管理员】管理题目-增删改查（按照题库查询题目、修改题目所属题库等）

### 1.2 高级功能（均为$P1$ ~ $P2$）

- 题目批量管理 $P1$

  - 【管理员】批量向题库添加题目
  - 【管理员】批量从题库移除题目
  - 【管理员】批量删除题目

- 分词题目搜索 $P1$

- 用户刷题记录日历图 $P1$

- 自动缓存热门题目 $P2$

- 网站流量控制和熔断 $P2$

- 动态 IP 黑白名单过滤 $P2$

- 同端登录冲突检测 $P2$

- 分级题目反爬虫策略 $P2$

## 2. 库表设计

### 2.1用户表

用户表的核心是用户登录凭证（账号密码）和个人信息，SQL 如下:

```sql
-- 用户表
create table if not exists user
(
    id           bigint auto_increment comment 'id' primary key,
    userAccount  varchar(256)                           not null comment '账号',
    userPassword varchar(512)                           not null comment '密码',
    unionId      varchar(256)                           null comment '微信开放平台id',
    mpOpenId     varchar(256)                           null comment '公众号openId',
    userName     varchar(256)                           null comment '用户昵称',
    userAvatar   varchar(1024)                          null comment '用户头像',
    userProfile  varchar(512)                           null comment '用户简介',
    userRole     varchar(256) default 'user'            not null comment '用户角色：user/admin/ban',
    editTime     datetime     default CURRENT_TIMESTAMP not null comment '编辑时间',
    createTime   datetime     default CURRENT_TIMESTAMP not null comment '创建时间',
    updateTime   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    isDelete     tinyint      default 0                 not null comment '是否删除',
    index idx_unionId (unionId)
) comment '用户' collate = utf8mb4_unicode_ci;
```

其中，`unionld`、`mpopenld` 是为了实现公众号登录的，也可以省略。每个微信用户在同一家公司(主体)的 `unionld` 是唯一的，在同一个公众号的 `mpOpenld` 是唯一的。
`editTime` 和 `updateTime` 的区别是：`editTime` 表示用户编辑个人信息的时间(需要业务代码来更新)，而 `updateTime` 表示这条用户记录任何字段发生修改的时间(由数据库自动更新)。

### 2.2 题库表

题库表的核心是题库信息(标题、描述、图片)，SQL 如下:

```sql
-- 题库表
create table if not exists question_bank
(
    id          bigint auto_increment comment 'id' primary key,
    title       varchar(256)                       null comment '标题',
    description text                               null comment '描述',
    picture     varchar(2048)                      null comment '图片',
    userId      bigint                             not null comment '创建用户 id',
    editTime    datetime default CURRENT_TIMESTAMP not null comment '编辑时间',
    createTime  datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updateTime  datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    isDelete    tinyint  default 0                 not null comment '是否删除',
    index idx_title (title)
) comment '题库' collate = utf8mb4_unicode_ci;
```

其中，`picture` 存储的是图片的 url 地址，而不是完整图片文件。通过 `userld` 和用户表关联，在本项目中只有管理员才能创建题库。
由于用户很可能按照标题搜索题库，所以给 `title` 字段增加索引。

### 2.3 题目表

题目表的核心是题目信息(标题、详细内容、标签)，SQL 如下:

```sql
-- 题目表
create table if not exists question
(
    id         bigint auto_increment comment 'id' primary key,
    title      varchar(256)                       null comment '标题',
    content    text                               null comment '内容',
    tags       varchar(1024)                      null comment '标签列表（json 数组）',
    answer     text                               null comment '推荐答案',
    userId     bigint                             not null comment '创建用户 id',
    editTime   datetime default CURRENT_TIMESTAMP not null comment '编辑时间',
    createTime datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updateTime datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    isDelete   tinyint  default 0                 not null comment '是否删除',
    index idx_title (title),
    index idx_userId (userId)
) comment '题目' collate = utf8mb4_unicode_ci;
```

几个重点:
1. 题目标题 `title` 和题目创建人 `userld` 是常用的题目搜索条件，所以添加索引提升查询性能。
2. 题目可能有多个标签，为了简化设计，没有采用关联表，而是以 JSON 数组字符串的方式存储，比如 `["Java"，"Python"]`。
3. 题目内容（详情）和题目答案可能很长，所以使用 `text` 类型。

### 2.4 题库题目关联表

由于一个题库可以有多个题目，一个题目可以属于多个题库，所以需要关联表来实现。

实现基础功能的 SQL 如下:

```sql
-- 题库题目表（硬删除）
create table if not exists question_bank_question
(
    id             bigint auto_increment comment 'id' primary key,
    questionBankId bigint                             not null comment '题库 id',
    questionId     bigint                             not null comment '题目 id',
    userId         bigint                             not null comment '创建用户 id',
    createTime     datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updateTime     datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    UNIQUE (questionBankId, questionId)
) comment '题库题目' collate = utf8mb4_unicode_ci;
```

几个重点：

1. 上述代码中的 `userld` 表示添加题目到题库的用户 id，仅管理员可操作。

2. 由于关联表中的数据记录并没有那么重要（一般由管理员维护），所以直接采用硬删除的方式，如果将题目移出题库，直接删掉对应的数据即可。按照这种设计，`createTime` 就是题目加入到题库的时间。

3. 通过给题库 id 和题目id 添加**联合唯一索引**，防止题目被重复添加到同一个题库中。而且要注意，将 `questionBankd` 放到前面，因为数据库中的查询大多是基于 `questiongankId` 进行的，比如査找某个题库中的所有问题，或者在一个题库中查找特定问题，将 `questionBankId` 放在前面符合查询模式，会使得这些查询更加高效（索引的最左前缀原则）。


