import{_ as l,c as t,a as s,g as a,b as p,d as n,e as r,f as h,r as d,o as c}from"./app-CG9sUNgL.js";const k={};function o(g,i){const e=d("RouteLink");return c(),t("div",null,[i[3]||(i[3]=s("h1",{id:"自建网盘兼图床",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#自建网盘兼图床"},[s("span",null,"自建网盘兼图床")])],-1)),i[4]||(i[4]=s("p",null,[a("网盘 ByteCloud："),s("a",{href:"https://cloud.braumace.cn",target:"_blank",rel:"noopener noreferrer"},"https://cloud.braumace.cn")],-1)),p(" more "),i[5]||(i[5]=n(`<p>继自建博客之后，需要展示图片，使用了一段时间 <a href="https://sso.qiniu.com/" target="_blank" rel="noopener noreferrer">七牛云</a> + CDN 加速，前阵子出现了各大知名博主 CDN 流量被盗刷事件，不禁有点害怕。</p><p>再加上文件放在云存储上，毕竟是公家的，文件上传都会被扫描一遍，毫无隐私可言，万一想存点嘿嘿的东西，那怎么办呢？而且公有云存储的存储有限，其次安全性和稳定性也不能一直保证，毕竟是放在别人家里，别人未必会帮你好好保存。</p><p>于是利用之前学过的，用 <a href="https://www.minio.org.cn/" target="_blank" rel="noopener noreferrer">MinIO</a> 在服务器上搭建了一个对象存储服务，可以在网页端上传和下载文件，但很快发现，它仅仅只能用来存储，不能实现外部的访问。比如我想实现一个图床，其自身并不能提供一个外部链接，供所有人访问。</p><p>其实解决方法也有，MinIO 提供了 SDK 和 API，可以给第三方调用，配合 Typora 或 PicGo 使用，也有很不错的效果，详情可自行百度。</p><p>这里我结合日常使用习惯和需要，选择使用 <a href="https://cloudreve.org/" target="_blank" rel="noopener noreferrer">Cloudreve</a>。</p><h2 id="什么是-cloudreve" tabindex="-1"><a class="header-anchor" href="#什么是-cloudreve"><span>什么是 Cloudreve</span></a></h2><p>Cloudreve 是一个支持多家云存储驱动的公有云文件系统，可助你即刻构建出兼备自用或公用的网盘服务，以跨平台、多用户、多存储节点、存储无关的方式，通过多种存储策略的支持、虚拟文件系统等特性实现灵活的文件管理体验。</p><figure><img src="https://cloud.braumace.cn/f/08wTB/Cloudreve.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>具有非常多的功能，可以分布式部署，集成了多家云存储端，既可以将文件存储在本地，也可以存储在外部，实现无差别存取；可以创建外链分享文件以及目录；支持 WebDAV 协议，可以从多种设备和应用上访问等等，可以说 Cloudreve 完美满足了我所需要的功能。</p><h2 id="搭建过程" tabindex="-1"><a class="header-anchor" href="#搭建过程"><span>搭建过程</span></a></h2><p>根据 <a href="https://docs.cloudreve.org/getting-started/install" target="_blank" rel="noopener noreferrer">官方文档</a>，快速部署。</p><ol><li><p>在 <a href="https://github.com/cloudreve/Cloudreve/releases" target="_blank" rel="noopener noreferrer">GitHub Release</a> 中下载已构建打包好的压缩包，选择 <code>linux_amd64.tar.gz</code> 版本。</p><p>直接放上压缩包（它真的太方便了）：<a href="https://cloud.braumace.cn/f/P7AU0/cloudreve_3.8.3_linux_amd64.tar.gz" target="_blank" rel="noopener noreferrer">cloudreve_3.8.3_linux_amd64.tar.gz</a></p></li><li><p>转到下载的文件夹目录，解压并启动。</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#解压获取到的主程序</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -zxvf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloudreve_3.8.3_linux_amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 赋予执行权限</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +x</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./cloudreve</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动 Cloudreve</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./cloudreve</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动后如下图所示：</p><figure><img src="https://cloud.braumace.cn/f/QlkUo/Cloudreve_init.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Cloudreve 在首次启动时，会创建初始管理员账号（上图黄色部分），请注意保管管理员密码，此密码只会在首次启动时出现。如果忘记了初始管理员密码，需要删除同级目录下的 <code>cloudreve.db</code>，重新启动主程序以初始化新的管理员账户。</p><p>启动后 Cloudreve 默认会监听 <code>5212</code> 端口，此时可以在浏览器中访问 <code>http://服务器IP:5212</code>，输入管理员账号密码进入 Cloudreve。</p><figure><img src="https://cloud.braumace.cn/f/oBdt2/Cloudreve_login.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>其实到这一步，这个网盘就已经搭建完成可以使用了。下面是一些个人配置。</p><ol start="3"><li>右上角「个人 - 管理面板」，配置站点信息</li></ol><figure><img src="https://cloud.braumace.cn/f/njDfz/Cloud_1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://cloud.braumace.cn/f/dy3S0/Cloud_2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="4"><li>配置存储策略</li></ol><p><code>本机存储</code> 即存储在安装 Cloudreve 的机器上，<code>从机存储</code> 用于配置分布式存储，另外也提供了常见的云存储供应商选项，可以将文件存储在第三方，通过 Cloudreve 访问。</p><figure><img src="https://cloud.braumace.cn/f/p7oCB/Cloud_3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>配置存储策略：存储目录为 Cloudreve 安装路径下的相对路径，也可以是机器的绝对路径。存储路径和文件名都可以使用 <code>魔法变量</code>，非常方便。</p><figure><img src="https://cloud.braumace.cn/f/k8pC5/Cloud_4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>最重要的是配置直链，开启后每个文件都会生成一个链接，允许外部访问，而且长度很短，只要不删除就能一直保留。有需要的话也可以配置 CDN 域名加速访问。</p><figure><img src="https://cloud.braumace.cn/f/D7xFX/Cloud_6.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>开启直链后的效果如下，任何一个文件都可以拥有一个外链，且<strong>不随文件位置的改变而变化，只与文件名有关</strong>。</p><p>这样就实现了一个图床的效果。</p>`,31)),s("p",null,[i[1]||(i[1]=a("后面配合 ")),r(e,{to:"/program/tool-build/%E8%87%AA%E5%BB%BA%E7%BD%91%E7%9B%98%E5%85%BC%E5%9B%BE%E5%BA%8A.html#%E9%85%8D%E7%BD%AE-webdav"},{default:h(()=>i[0]||(i[0]=[a("WebDAV")])),_:1}),i[2]||(i[2]=a("，在本地保存图片后，云端生成外链使用，并且图片如果有修改，只要文件名不变，外链也不用改。"))]),i[6]||(i[6]=n(`<figure><img src="https://cloud.braumace.cn/f/LBwTl/Cloud_7.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>后面的配置自行设置即可。新添加一个存储策略时采用的是 <strong>向导模式编辑</strong>，后续可以通过 <strong>专家模式</strong> 进行更详细的配置。</p><ol start="5"><li>在用户组里面，可以指定用户使用的存储策略和可用的最大容量，以及下载限速（当然不建议这么做）、创建分享链接等等。默认的下载不限速，下载速度只和机器自身的性能相关。</li></ol><figure><img src="https://cloud.braumace.cn/f/WPWH7/Cloud_8.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="6"><li>如果不想用默认创建的管理员账号密码，可以进行修改。</li></ol><figure><img src="https://cloud.braumace.cn/f/lEgcD/Cloud_9.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="配置进程守护" tabindex="-1"><a class="header-anchor" href="#配置进程守护"><span>配置进程守护</span></a></h2><p>什么是守护进程：<a href="https://blog.csdn.net/qq_45172832/article/details/134829935" target="_blank" rel="noopener noreferrer">深入理解守护进程：守护进程干嘛的？</a></p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p><strong>守护进程（Daemon）</strong>：是一类在后台运行的系统服务进程，而不是在交互式用户界面下运行的进程。它们通常在系统启动时启动，并持续运行以提供某种服务或执行特定任务。守护进程独立于任何终端会话，通常不接受用户输入，而是通过系统的事件驱动或定时器来执行任务。</p></div><p>Linux 系统有很多守护进程，大多数服务都是用守护进程实现的。例如常见的常见的守护进程包括系统日志进程 <code>syslogd</code>、 Web 服务器 <code>httpd</code>、邮件服务器 <code>sendmail</code> 和数据库服务器 <code>mysqld</code> 等。</p><p>为什么要配置进程守护呢？</p><p>因为我们的 Cloudreve 作为一个网盘，相当于是一个文件服务器，其要求一定是能稳定运行，这样我们才能随时随地使用它。如果不将它注册为一个进程，进行进程守护，万一服务器突然宕机或停电等，我们的网盘服务将变得不可用。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>从前面使用 <code>./cloudreve</code> 命令启动服务可以看出，其实 Cloudreve 默认启动方式是<strong>前台启动</strong>，好处是可以提供即时的交互体验和日志查看，但坏处是它会占用大量的系统资源，除非关闭否则无法使用其他 Linux 命令、无法使用其他应用程序，且运行不稳定，容易受到干扰而崩溃停止。</p></div><p>所以需要将 Cloudreve 注册为一个进程，设置开机自动启动，当服务器宕机后恢复也能够重启服务。</p><p>官方文档中提供了两种配置进程守护的方法，分别是 <strong>Systemd</strong> 和 <strong>Supervisor</strong>。</p><ul><li><code>Systemd</code> 是Linux 自带的系统和服务管理器，常见命令以 <code>systemctl</code> 开头。</li><li><code>Supervisor</code> 是一个轻量级的进程管理工具，推荐搭配宝塔面板使用，效果更好。</li></ul><p>这里我使用 <code>Systemd</code> 配置进程守护：</p><ol><li>创建配置文件</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/lib/systemd/system/cloudreve.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>将下面代码粘贴到配置文件中，并将下文 <code>PATH_TO_CLOUDREVE</code> 更换为程序所在目录</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Description</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Cloudreve</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Documentation</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">https://docs.cloudreve.org</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">After</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">network.target</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">After</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mysqld.service</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Wants</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">network.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">WorkingDirectory</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/PATH_TO_CLOUDREVE</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ExecStart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/PATH_TO_CLOUDREVE/cloudreve</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Restart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">on-abnormal</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">RestartSec</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">5s</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">KillMode</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mixed</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">StandardOutput</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">null</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">StandardError</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">syslog</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">WantedBy</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">multi-user.target</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>更新配置并设置开机启动</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 更新配置</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> daemon-reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动服务</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloudreve</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置开机启动</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloudreve</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>管理命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 启动服务</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloudreve</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 停止服务</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloudreve</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重启服务</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloudreve</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看状态</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloudreve</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置站点-url-及免费-https" tabindex="-1"><a class="header-anchor" href="#配置站点-url-及免费-https"><span>配置站点 URL 及免费 HTTPS</span></a></h2><ol><li>先去阿里云服务器配置 <a href="https://dns.console.aliyun.com/?spm=5176.ecscore_overview.products-recent.ddns.450e4df5vAmVEW#/dns/domainList" target="_blank" rel="noopener noreferrer">域名解析DNS</a>，添加记录，填写想配置的「二级域名」，再填写「服务器 IP 地址」即可。</li></ol><figure><img src="https://cloud.braumace.cn/f/Xnoh0/Cloud_12.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="2"><li>再去 <a href="https://yundun.console.aliyun.com/?spm=5176.ecscore_overview.products-recent.dcas.450e4df5vAmVEW&amp;p=cas#/overview" target="_blank" rel="noopener noreferrer">阿里云数字证书管理服务</a> 申请免费的 SSL 证书。</li></ol><p>原「免费证书」已经换成了「个人测试证书」，点击「创建证书」。</p><figure><img src="https://cloud.braumace.cn/f/EPWcY/Cloud_10.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>输入想要配置的域名，勾选「快捷签发」，第一次申请的时候要填个人信息，签发速度会比较慢，大概 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 个小时，后面再申请的时候就很快了，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span> 分钟左右就能批下来。</p><figure><img src="https://cloud.braumace.cn/f/NGEcv/Cloud_11.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>得到 SSL 证书后，下载证书，选择服务器类型为 <code>Nginx</code>。</p><figure><img src="https://cloud.braumace.cn/f/xGYhl/Cloud_13.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol start="3"><li>解压后将 <code>pem</code> 和 <code>key</code> 文件上传至 Linux 服务器，建议放在 Nginx 目录下，然后修改 Nginx 的配置文件 <code>nginx.conf</code>。</li></ol><div class="hint-container tip"><p class="hint-container-title">提示</p><p>使用 Linux 命令安装的 Nginx，默认路径在 <code>/usr/nginx/</code></p><p>而使用宝塔面板安装的 Nginx，默认路径在 <code>/www/server/panel/vhost/nginx</code></p><p>可以通过查看 nginx 的运行进程，显示 nginx 的 安装目录</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ps</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -aux</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></div><p>在 <code>nginx.conf</code> 中添加如下配置：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">http</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        listen</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       443</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        listen</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       [::]:443 ssl http2;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        server_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  cloud.braumace.cn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 指定域名</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         /usr/share/nginx/html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ssl_certificate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/pki/nginx/cloud.braumace.cn.pem</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># pem存放路径</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ssl_certificate_key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/pki/nginx/cloud.braumace.cn.key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># key存放路径</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ssl_session_cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shared:SSL:1m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ssl_session_timeout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  10m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ssl_ciphers</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PROFILE=SYSTEM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        ssl_prefer_server_ciphers</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            proxy_set_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> X-Forwarded-For</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $proxy_add_x_forwarded_for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            proxy_set_header</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            proxy_redirect</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            proxy_pass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://127.0.0.1:5212</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 本地访问端口</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # 如果要使用本地存储策略，请将下一行注释符删除，并更改大小为理论最大文件尺寸</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            client_max_body_size</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 20000m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        error_page</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 404</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /404.html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /40x.html</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        error_page</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 500</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 502</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 503</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 504</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /50x.html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            location</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /50x.html</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>最后在 Cloudreve 管理面板，「站点信息」里面配置站点 URL 为 <code>https://cloud.braumace.cn</code> 即可。</li></ol><h2 id="配置-webdav" tabindex="-1"><a class="header-anchor" href="#配置-webdav"><span>配置 WebDAV</span></a></h2><h3 id="什么是-webdav" tabindex="-1"><a class="header-anchor" href="#什么是-webdav"><span>什么是 WebDAV</span></a></h3><p>WebDAV 是一种基于 HTTP 协议的文件传输协议，如今有许多第三方文件管理器、视频播放器等产品都支持通过 WebDAV 协议访问 Cloudreve 中的文件，可以借此实现跨平台的文件共享与同步。</p><p>简单来说，WebDAV 就像一个存储服务，各种应用都可以连接到它，允许应用直接访问我们的云盘内容，对其进行读写操作。</p><h3 id="cloudreve-使用-webdav" tabindex="-1"><a class="header-anchor" href="#cloudreve-使用-webdav"><span>Cloudreve 使用 WebDAV</span></a></h3><p>Cloudreve 要使用 WebDAV，要先在后台管理面板为对应用户组开启 WebDAV 使用权限。WebDAV 所使用的账号与 Cloudreve 账号并不互通，需要单独创建。</p><p>再前往前台 「导航左侧 - 连接 - 创建新账号」 创建供 WebDAV 使用的账号信息。创建完成后系统会为此账号自动生成密码，得到 WebDAV 的连接地址，密码则为系统所生成的密码。</p><figure><img src="https://cloud.braumace.cn/f/vJrcE/Cloud_14.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>创建 WebDAV 账号时，可以为此账号指定相对根目录，此账号只能通过 WebDAV 访问所指定相对根目录下的目录及文件。</p><h3 id="windows-使用-webdav" tabindex="-1"><a class="header-anchor" href="#windows-使用-webdav"><span>Windows 使用 WebDAV</span></a></h3><p>在上方菜单中，找到「计算机 - 映射网络驱动器」，点击添加。</p><figure><img src="https://cloud.braumace.cn/f/AmKfE/Cloud_15.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>指定驱动器号，将 Cloudreve 系统生成的连接地址填入，点击「完成」再填入账号和生成的密码。</p><figure><img src="https://cloud.braumace.cn/f/yXzS1/Cloud_16.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>连接成功后如下所示：</p><figure><img src="https://cloud.braumace.cn/f/9GRSr/Cloud_17.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>这样就实现了无感知地调用，可以像操作本地磁盘一样操作网盘了，包括文件的读取、存储，第三方平台对文件的读取保存都和本地一模一样。<br> （不过存储空间是映射的本地 C 盘的，应该是 Windows 本身的 WebDAV 不支持，获取不到实际的存储大小）</p>`,57))])}const m=l(k,[["render",o],["__file","自建网盘兼图床.html.vue"]]),v=JSON.parse('{"path":"/program/tool-build/%E8%87%AA%E5%BB%BA%E7%BD%91%E7%9B%98%E5%85%BC%E5%9B%BE%E5%BA%8A.html","title":"自建网盘兼图床","lang":"zh-CN","frontmatter":{"category":["工具搭建"],"tag":["教程"],"sticky":true,"description":"网盘 ByteCloud：https://cloud.braumace.cn","head":[["meta",{"property":"og:url","content":"https://blog.braumace.cn/ByteLighting/program/tool-build/%E8%87%AA%E5%BB%BA%E7%BD%91%E7%9B%98%E5%85%BC%E5%9B%BE%E5%BA%8A.html"}],["meta",{"property":"og:site_name","content":"ByteLighting"}],["meta",{"property":"og:title","content":"自建网盘兼图床"}],["meta",{"property":"og:description","content":"网盘 ByteCloud：https://cloud.braumace.cn"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cloud.braumace.cn/f/08wTB/Cloudreve.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-05T12:57:41.000Z"}],["meta",{"property":"article:tag","content":"教程"}],["meta",{"property":"article:modified_time","content":"2024-10-05T12:57:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"自建网盘兼图床\\",\\"image\\":[\\"https://cloud.braumace.cn/f/08wTB/Cloudreve.png\\",\\"https://cloud.braumace.cn/f/QlkUo/Cloudreve_init.png\\",\\"https://cloud.braumace.cn/f/oBdt2/Cloudreve_login.png\\",\\"https://cloud.braumace.cn/f/njDfz/Cloud_1.png\\",\\"https://cloud.braumace.cn/f/dy3S0/Cloud_2.png\\",\\"https://cloud.braumace.cn/f/p7oCB/Cloud_3.png\\",\\"https://cloud.braumace.cn/f/k8pC5/Cloud_4.png\\",\\"https://cloud.braumace.cn/f/D7xFX/Cloud_6.png\\",\\"https://cloud.braumace.cn/f/LBwTl/Cloud_7.png\\",\\"https://cloud.braumace.cn/f/WPWH7/Cloud_8.png\\",\\"https://cloud.braumace.cn/f/lEgcD/Cloud_9.png\\",\\"https://cloud.braumace.cn/f/Xnoh0/Cloud_12.png\\",\\"https://cloud.braumace.cn/f/EPWcY/Cloud_10.png\\",\\"https://cloud.braumace.cn/f/NGEcv/Cloud_11.png\\",\\"https://cloud.braumace.cn/f/xGYhl/Cloud_13.png\\",\\"https://cloud.braumace.cn/f/vJrcE/Cloud_14.png\\",\\"https://cloud.braumace.cn/f/AmKfE/Cloud_15.png\\",\\"https://cloud.braumace.cn/f/yXzS1/Cloud_16.png\\",\\"https://cloud.braumace.cn/f/9GRSr/Cloud_17.png\\"],\\"dateModified\\":\\"2024-10-05T12:57:41.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"BraumAce\\",\\"url\\":\\"https://blog.braumace.cn/article\\"}]}"]]},"headers":[{"level":2,"title":"什么是 Cloudreve","slug":"什么是-cloudreve","link":"#什么是-cloudreve","children":[]},{"level":2,"title":"搭建过程","slug":"搭建过程","link":"#搭建过程","children":[]},{"level":2,"title":"配置进程守护","slug":"配置进程守护","link":"#配置进程守护","children":[]},{"level":2,"title":"配置站点 URL 及免费 HTTPS","slug":"配置站点-url-及免费-https","link":"#配置站点-url-及免费-https","children":[]},{"level":2,"title":"配置 WebDAV","slug":"配置-webdav","link":"#配置-webdav","children":[{"level":3,"title":"什么是 WebDAV","slug":"什么是-webdav","link":"#什么是-webdav","children":[]},{"level":3,"title":"Cloudreve 使用 WebDAV","slug":"cloudreve-使用-webdav","link":"#cloudreve-使用-webdav","children":[]},{"level":3,"title":"Windows 使用 WebDAV","slug":"windows-使用-webdav","link":"#windows-使用-webdav","children":[]}]}],"git":{"createdTime":1723724670000,"updatedTime":1728133061000,"contributors":[{"name":"BraumAce","email":"1693717911@qq.com","commits":4}]},"readingTime":{"minutes":9.54,"words":2863},"filePathRelative":"program/tool-build/自建网盘兼图床.md","localizedDate":"2024年8月15日","excerpt":"\\n<p>网盘 ByteCloud：<a href=\\"https://cloud.braumace.cn\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://cloud.braumace.cn</a></p>\\n","autoDesc":true}');export{m as comp,v as data};
